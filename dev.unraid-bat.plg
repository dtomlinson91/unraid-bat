<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
  <!ENTITY name       "unraid-bat">
  <!ENTITY author     "dtomlinson">
  <!ENTITY org        "dtomlinson91">
  <!ENTITY version    "v0.20.0">
  <!ENTITY gitURL     "https://git.panaetius.co.uk/&org;/&name;">
  <!ENTITY pluginURL  "&gitURL;/raw/branch/master/&name;.plg">
  <!ENTITY releaseURL "&gitURL;/releases/download/&version;/&name;-&version;.txz">
  <!ENTITY md5        "b49a912a3702d5704b6cecfcd8564d33">
  <!ENTITY plugin     "/boot/config/plugins/&name;">
  <!ENTITY emhttp     "/usr/local/emhttp/plugins/&name;">
]>

<PLUGIN  name="&name;" author="&author;" version="&version;" pluginURL="&pluginURL;" min="6.8.3">

<CHANGES>

###2022-05-05
- Initial release - bat v0.20.0

</CHANGES>

<FILE Run="/bin/bash">
<INLINE>
<!-- remove previous version if present -->
file=$(/usr/bin/ls /boot/config/plugins/&name;/&name;*.txz | grep -v '&version;')
if [ ! -z "$file" ]
then
  filename=$(basename -- $file)
  previous="${filename%.*}"
  echo "previous version ${previous} found - uninstalling"
  removepkg $previous
  rm -f $file
else
  echo "no previous version found - first time install"
fi
</INLINE>
</FILE>

<FILE Name="/boot/config/plugins/&name;/&name;-&version;.txz" Run="upgradepkg --install-new">
<URL>&releaseURL;</URL>
<MD5>&md5;</MD5>
</FILE>

<FILE Name="&emhttp;/README.md">
<INLINE>
  **bat**

  A cat(1) clone with syntax highlighting and Git integration.

  See the [git repository](https://github.com/sharkdp/bat) for bat for more information.
</INLINE>
</FILE>

<FILE Run="/bin/bash" Method="remove">
<INLINE>
echo "*** Removing bat ***"

# Remove plugin related files
removepkg &name;-&version;

rm -rf &emhttp;
rm -rf &plugin;

echo
echo "*** Successfully removed bat ***"
</INLINE>
</FILE>
</PLUGIN>
